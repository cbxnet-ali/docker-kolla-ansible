From 3e679c6bd81526a2ae7e7507fed480fe74123a30 Mon Sep 17 00:00:00 2001
From: Christian Berendt <berendt@betacloud-solutions.de>
Date: Thu, 11 Jan 2018 14:57:40 +0100
Subject: [PATCH] Make custom elasticsearch configuration files possible

Change-Id: I76183db33d7339e8a446bf687cd6e9865a303aac
---

diff --git a/ansible/roles/elasticsearch/tasks/config.yml b/ansible/roles/elasticsearch/tasks/config.yml
index 958f71d..21b5f6e 100644
--- a/ansible/roles/elasticsearch/tasks/config.yml
+++ b/ansible/roles/elasticsearch/tasks/config.yml
@@ -33,8 +33,12 @@
 - name: Copying over elasticsearch.yml
   template:
     src: "elasticsearch.yml.j2"
-    dest: "{{ node_config_directory }}/{{ item.key }}/{{ item.key }}.yml"
+    dest: "{{ node_config_directory }}/elasticsearch/{{ item.key }}.yml"
   register: elasticsearch_confs
+  with_first_found:
+    - "{{ node_custom_config }}/elasticsearch/{{ inventory_hostname }}/{{ item.key }}.yml"
+    - "{{ node_custom_config }}/elasticsearch/{{ item.key }}.yml"
+    - "{{ item.key }}.yml.j2"
   when:
     - inventory_hostname in groups[item.value.group]
     - item.value.enabled | bool
